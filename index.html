<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tuktuk Drive | Multi-Role Prototype</title>
    <meta name="description" content="Transport and Delivery Solution for Egypt - Prototype">

    <style>
        /* =========================================
           1. CSS VARIABLES & THEME
           ========================================= */
        :root {
            /* Brand Palette */
            --primary: #7C3AED;      /* Electric Purple */
            --primary-light: #8B5CF6;
            --secondary: #06B6D4;    /* Turquoise */
            --accent: #FACC15;       /* Energetic Yellow */
            --bg-body: #F3F4F6;
            --bg-card: #FFFFFF;
            --text-main: #1F2937;
            --text-muted: #6B7280;
            --border: #E5E7EB;
            
            /* Status Colors */
            --success: #10B981; /* Free / Completed */
            --danger: #EF4444;  /* Busy */
            --warning: #F59E0B; /* Pending */

            /* UI Metrics */
            --radius: 16px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-hover: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg-body: #111827;
            --bg-card: #1F2937;
            --text-main: #F9FAFB;
            --text-muted: #9CA3AF;
            --border: #374151;
        }

        /* =========================================
           2. BASE STYLES & RESET
           ========================================= */
        * { box-sizing: border-box; margin: 0; padding: 0; transition: all 0.2s ease; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* Layout Utilities */
        .container { max-width: 1100px; margin: 0 auto; padding: 0 1rem; width: 100%; flex: 1; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .grid { display: grid; gap: 1rem; }
        .grid-2 { grid-template-columns: 1fr; }
        .grid-4 { grid-template-columns: 1fr; }
        .hidden { display: none !important; }
        .mt-4 { margin-top: 1rem; } .mb-4 { margin-bottom: 1rem; }
        .text-center { text-align: center; }

        @media (min-width: 768px) {
            .grid-2 { grid-template-columns: 1fr 1fr; }
            .grid-4 { grid-template-columns: repeat(4, 1fr); }
        }

        /* Components */
        .btn {
            border: none; padding: 0.75rem 1.5rem; border-radius: 99px; font-weight: 700;
            cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
        }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-outline { border: 2px solid var(--border); background: transparent; color: var(--text-main); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        
        .card { background: var(--bg-card); border-radius: var(--radius); padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .card:hover { box-shadow: var(--shadow-hover); border-color: var(--primary-light); }
        
        .input-group input, .input-group select {
            width: 100%; padding: 1rem; border-radius: var(--radius); border: 1px solid var(--border);
            background: var(--bg-body); color: var(--text-main); margin-bottom: 0.5rem;
        }

        .badge { padding: 0.25rem 0.75rem; border-radius: 99px; font-size: 0.8rem; font-weight: bold; }
        .badge-free { background: #D1FAE5; color: #065F46; }
        .badge-busy { background: #FEE2E2; color: #991B1B; }

        /* =========================================
           3. SPECIFIC SECTIONS
           ========================================= */
        
        /* Header */
        header { background: var(--bg-card); padding: 1rem 0; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--border); }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary); display: flex; align-items: center; gap: 0.5rem; }
        .logo span { color: var(--secondary); }

        /* Auth Cards */
        .auth-card { text-align: center; cursor: pointer; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; }
        .auth-icon { font-size: 3rem; margin-bottom: 1rem; }
        
        /* Driver List (Passenger View) */
        .driver-row { display: flex; align-items: center; justify-content: space-between; padding: 1rem; border-bottom: 1px solid var(--border); }
        .driver-row:last-child { border-bottom: none; }
        
        /* Owner Charts (CSS Only) */
        .chart-bar { height: 10px; background: var(--border); border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .chart-fill { height: 100%; background: var(--primary); width: 0; transition: width 1s ease; }

        /* Delivery Protocol */
        .checklist { display: flex; gap: 1rem; margin-top: 1rem; }
        .check-item { flex: 1; border: 2px dashed var(--border); padding: 1rem; border-radius: var(--radius); text-align: center; opacity: 0.6; }
        .check-item.done { border-style: solid; border-color: var(--success); background: rgba(16, 185, 129, 0.1); opacity: 1; }
        .check-icon { font-size: 1.5rem; display: block; margin-bottom: 0.5rem; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <header>
        <div class="container flex justify-between items-center">
            <div class="logo" onclick="app.logout()">
                üõ∫ Tuktuk<span>Drive</span>
            </div>
            <div class="flex items-center" style="gap: 0.5rem;">
                <button class="btn btn-outline" style="padding: 5px 10px;" onclick="app.toggleTheme()">‚óë</button>
                <button class="btn btn-outline" style="padding: 5px 10px;" onclick="app.toggleLang()">
                    <span id="lang-disp">EN</span>
                </button>
                <button id="btn-logout" class="btn btn-danger hidden" style="padding: 5px 15px;" onclick="app.logout()" data-i18n="logout">Logout</button>
            </div>
        </div>
    </header>

    <main>
        
        <!-- VIEW 1: LANDING / AUTH SELECTION -->
        <section id="view-landing" class="container" style="padding-top: 2rem;">
            <div class="text-center mb-4">
                <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;" data-i18n="welcome_title">Choose Your Role</h1>
                <p style="color: var(--text-muted);" data-i18n="welcome_sub">Simulation Prototype - No Password Required</p>
            </div>

            <div class="grid grid-4">
                <!-- Passenger -->
                <div class="card auth-card" onclick="app.login('passenger')">
                    <div class="auth-icon">üôã‚Äç‚ôÇÔ∏è</div>
                    <h3 data-i18n="role_passenger">Passenger</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted);" data-i18n="desc_passenger">Book rides & delivery</p>
                </div>
                <!-- Driver -->
                <div class="card auth-card" onclick="app.login('driver')">
                    <div class="auth-icon">üõ∫</div>
                    <h3 data-i18n="role_driver">Driver</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted);" data-i18n="desc_driver">Accept jobs & earn</p>
                </div>
                <!-- Admin -->
                <div class="card auth-card" onclick="app.login('admin')">
                    <div class="auth-icon">üë®‚Äçüíª</div>
                    <h3 data-i18n="role_admin">Admin</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted);" data-i18n="desc_admin">Manage operations</p>
                </div>
                <!-- Owner -->
                <div class="card auth-card" style="border-color: var(--accent);" onclick="app.login('owner')">
                    <div class="auth-icon">üíº</div>
                    <h3 data-i18n="role_owner">Owner</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted);" data-i18n="desc_owner">Business insights</p>
                </div>
            </div>
        </section>

        <!-- VIEW 2: PASSENGER DASHBOARD -->
        <section id="view-passenger" class="container hidden" style="padding-top: 2rem;">
            <h2 class="mb-4"><span data-i18n="hello">Hello</span>, Passenger</h2>
            
            <div class="grid grid-2">
                <!-- Booking Panel -->
                <div class="card">
                    <h3 class="mb-4" data-i18n="book_ride">Book a Ride</h3>
                    
                    <div class="input-group">
                        <select id="service-type" onchange="app.toggleServiceType()">
                            <option value="ride" data-i18n="opt_personal">Personal Ride</option>
                            <option value="delivery" data-i18n="opt_delivery">Goods Delivery</option>
                        </select>
                        <input type="text" placeholder="Pickup Location" data-i18n-ph="ph_pickup">
                        <input type="text" placeholder="Destination" data-i18n-ph="ph_dest">
                    </div>

                    <div id="driver-list-container">
                        <h4 style="margin: 1rem 0; color: var(--text-muted);" data-i18n="avail_drivers">Available Drivers (Free)</h4>
                        <div id="driver-list" style="max-height: 300px; overflow-y: auto;">
                            <!-- Injected via JS -->
                        </div>
                    </div>
                </div>

                <!-- Active Ride Panel -->
                <div class="card" id="passenger-active-panel" style="opacity: 0.5; pointer-events: none;">
                    <h3 class="mb-4" data-i18n="active_trip">Active Trip</h3>
                    <div id="passenger-status-msg" class="text-center" style="padding: 2rem;">
                        <p data-i18n="no_active_trip">No active trip.</p>
                    </div>
                    
                    <!-- Delivery Protocol UI -->
                    <div id="delivery-protocol-ui" class="hidden">
                        <div class="checklist">
                            <div class="check-item" id="chk-driver-proof">
                                <span class="check-icon">üì∑</span>
                                <small data-i18n="step_driver_proof">Driver Proof</small>
                            </div>
                            <div class="check-item" id="chk-user-confirm">
                                <span class="check-icon">‚úÖ</span>
                                <small data-i18n="step_you_confirm">Your Confirm</small>
                            </div>
                        </div>
                        <button id="btn-user-confirm" class="btn btn-success mt-4" style="width: 100%" onclick="app.passengerConfirmReceipt()" disabled>
                            <span data-i18n="btn_confirm_receipt">Confirm Receipt</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- VIEW 3: DRIVER DASHBOARD -->
        <section id="view-driver" class="container hidden" style="padding-top: 2rem;">
            <div class="flex justify-between items-center mb-4">
                <h2>Capt. <span id="driver-name-display">Sayed</span></h2>
                <div class="badge badge-free" id="driver-status-badge" style="font-size: 1rem; padding: 0.5rem 1rem;">Free</div>
            </div>

            <div class="grid grid-2">
                <!-- Job Card -->
                <div class="card">
                    <h3 data-i18n="current_job">Current Job</h3>
                    <div id="driver-job-area" class="text-center mt-4">
                        <p style="color: var(--text-muted); margin-bottom: 1rem;" data-i18n="waiting_jobs">Waiting for requests...</p>
                        <div class="loader hidden" style="border: 3px solid var(--border); border-top: 3px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                    </div>

                    <!-- Active Job Controls -->
                    <div id="driver-active-controls" class="hidden mt-4">
                        <div style="background: var(--bg-body); padding: 1rem; border-radius: var(--radius); margin-bottom: 1rem;">
                            <strong>To:</strong> <span id="job-dest">Maadi</span><br>
                            <strong>Type:</strong> <span id="job-type">Personal</span><br>
                            <strong>Fare:</strong> 50 EGP
                        </div>

                        <!-- Delivery Specific Button -->
                        <button id="btn-driver-proof" class="btn btn-outline mb-4" style="width: 100%;" onclick="app.driverUploadProof()">
                            üì∑ <span data-i18n="btn_upload_proof">Upload Proof</span>
                        </button>
                        
                        <button class="btn btn-primary" style="width: 100%;" onclick="app.driverCompleteRide()">
                            üèÅ <span data-i18n="btn_end_trip">End Trip</span>
                        </button>
                    </div>
                </div>

                <!-- Stats -->
                <div class="card">
                    <h3 data-i18n="my_earnings">My Earnings</h3>
                    <div style="font-size: 2.5rem; font-weight: 900; color: var(--secondary); margin: 1rem 0;">
                        <span id="driver-earnings">150</span> EGP
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-muted);">Today's Total</p>
                </div>
            </div>
        </section>

        <!-- VIEW 4: ADMIN DASHBOARD -->
        <section id="view-admin" class="container hidden" style="padding-top: 2rem;">
            <h2 class="mb-4" style="color: var(--primary);" data-i18n="dash_admin">Admin Dashboard</h2>
            
            <div class="card mb-4">
                <h3 class="mb-4" data-i18n="live_fleet">Live Fleet Status</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="text-align: right; border-bottom: 2px solid var(--border);">
                                <th style="padding: 1rem;" data-i18n="tbl_id">ID</th>
                                <th data-i18n="tbl_name">Name</th>
                                <th data-i18n="tbl_vehicle">Vehicle</th>
                                <th data-i18n="tbl_status">Status</th>
                                <th data-i18n="tbl_action">Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-fleet-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- VIEW 5: OWNER DASHBOARD -->
        <section id="view-owner" class="container hidden" style="padding-top: 2rem;">
            <h2 class="mb-4" style="color: var(--accent); text-shadow: 0 1px 2px rgba(0,0,0,0.1);" data-i18n="dash_owner">Owner Overview</h2>

            <!-- KPI Cards -->
            <div class="grid grid-4 mb-4">
                <div class="card text-center">
                    <small data-i18n="kpi_revenue">Total Revenue</small>
                    <div style="font-size: 1.8rem; font-weight: bold;">50k EGP</div>
                </div>
                <div class="card text-center">
                    <small data-i18n="kpi_trips">Total Trips</small>
                    <div style="font-size: 1.8rem; font-weight: bold;">1,240</div>
                </div>
                <div class="card text-center">
                    <small data-i18n="kpi_users">Active Users</small>
                    <div style="font-size: 1.8rem; font-weight: bold;">850</div>
                </div>
                <div class="card text-center">
                    <small data-i18n="kpi_commission">Net Commission</small>
                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--success);">10%</div>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-2">
                <div class="card">
                    <h3 data-i18n="chart_growth">Monthly Growth</h3>
                    <div style="margin-top: 1rem;">
                        <div class="flex justify-between" style="font-size: 0.8rem; margin-bottom: 5px;"><span>Jan</span><span>40%</span></div>
                        <div class="chart-bar"><div class="chart-fill" style="width: 40%;"></div></div>
                        
                        <div class="flex justify-between" style="font-size: 0.8rem; margin-bottom: 5px; margin-top: 10px;"><span>Feb</span><span>65%</span></div>
                        <div class="chart-bar"><div class="chart-fill" style="width: 65%;"></div></div>
                        
                        <div class="flex justify-between" style="font-size: 0.8rem; margin-bottom: 5px; margin-top: 10px;"><span>Mar</span><span>85%</span></div>
                        <div class="chart-bar"><div class="chart-fill" style="width: 85%;"></div></div>
                    </div>
                </div>
                <div class="card">
                    <h3 data-i18n="chart_types">Trip Types</h3>
                    <div style="display: flex; justify-content: center; align-items: center; height: 150px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: conic-gradient(var(--primary) 0% 70%, var(--secondary) 70% 100%);"></div>
                        <div style="margin-right: 1rem;">
                            <div style="color: var(--primary);">‚ñ† Personal (70%)</div>
                            <div style="color: var(--secondary);">‚ñ† Delivery (30%)</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- FOOTER -->
    <footer>
        <div class="container text-center" style="padding: 2rem 0; color: var(--text-muted); font-size: 0.9rem;">
            <p>&copy; 2025 Tuktuk Drive. All rights reserved.</p>
            <div class="flex justify-center gap-2 mt-4" style="gap: 1rem;">
                <a href="#" style="color: inherit;" data-i18n="link_about">About</a>
                <a href="#" style="color: inherit;" data-i18n="link_privacy">Privacy</a>
                <a href="#" style="color: inherit;" data-i18n="link_support">Support</a>
            </div>
        </div>
    </footer>

    <script>
        /**
         * Tuktuk Drive - Prototype Logic
         */
        const app = {
            // --- State ---
            data: {
                lang: 'ar',
                theme: 'light',
                currentUserRole: null,
                activeRide: null, // { driverId, type, status: 'pending'|'active'|'proof_done'|'completed' }
                drivers: [
                    { id: 1, name: 'Sayed Turbo', vehicle: 'Bajaj 2024', status: 'free', rating: 4.9 },
                    { id: 2, name: 'Mahmoud King', vehicle: 'Piaggio', status: 'busy', rating: 4.5 },
                    { id: 3, name: 'Hassan Fox', vehicle: 'TVS Cargo', status: 'free', rating: 4.8 },
                    { id: 4, name: 'Ali Prince', vehicle: 'Bajaj 2022', status: 'free', rating: 4.7 }
                ],
                driverEarnings: 150
            },

            // --- Translations ---
            i18n: {
                ar: {
                    welcome_title: "ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ≠ÿ≥ÿßÿ®",
                    welcome_sub: "ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ¨ÿ±Ÿäÿ®Ÿä - ŸÑÿß Ÿäÿ™ÿ∑ŸÑÿ® ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±",
                    role_passenger: "ÿ±ÿßŸÉÿ®",
                    role_driver: "ÿ≥ÿßÿ¶ŸÇ",
                    role_admin: "ŸÖÿ≥ÿ§ŸàŸÑ (Admin)",
                    role_owner: "ŸÖÿßŸÑŸÉ (Owner)",
                    desc_passenger: "ÿ≠ÿ¨ÿ≤ ŸÖÿ¥ÿßŸàŸäÿ± Ÿàÿ™ŸàÿµŸäŸÑ",
                    desc_driver: "ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ ÿ∑ŸÑÿ®ÿßÿ™",
                    desc_admin: "ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÖŸÑŸäÿßÿ™",
                    desc_owner: "ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑÿ£ÿπŸÖÿßŸÑ",
                    logout: "ÿÆÿ±Ÿàÿ¨",
                    hello: "ÿ£ŸáŸÑÿßŸã",
                    book_ride: "ÿ≠ÿ¨ÿ≤ ŸÖÿ¥Ÿàÿßÿ±",
                    opt_personal: "ŸÖÿ¥Ÿàÿßÿ± ÿ¥ÿÆÿµŸä",
                    opt_delivery: "ÿ™ŸàÿµŸäŸÑ ÿ®ÿ∂ÿßÿπÿ©",
                    avail_drivers: "ÿßŸÑÿ≥ÿßÿ¶ŸÇŸäŸÜ ÿßŸÑŸÖÿ™ÿßÿ≠ŸäŸÜ",
                    active_trip: "ÿßŸÑÿ±ÿ≠ŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©",
                    no_active_trip: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≠ŸÑÿ© ŸÜÿ¥ÿ∑ÿ©",
                    step_driver_proof: "ÿ•ÿ´ÿ®ÿßÿ™ ÿßŸÑÿ≥ÿßÿ¶ŸÇ",
                    step_you_confirm: "ÿ™ÿ£ŸÉŸäÿØŸÉ",
                    btn_confirm_receipt: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ",
                    current_job: "ÿßŸÑŸÖŸáŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©",
                    waiting_jobs: "ŸÅŸä ÿßŸÜÿ™ÿ∏ÿßÿ± ÿ∑ŸÑÿ®ÿßÿ™...",
                    btn_upload_proof: "ÿ±ŸÅÿπ ÿµŸàÿ±ÿ© ÿßŸÑÿ™ÿ≥ŸÑŸäŸÖ",
                    btn_end_trip: "ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©",
                    my_earnings: "ÿ£ÿ±ÿ®ÿßÿ≠Ÿä",
                    dash_admin: "ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ (Admin)",
                    live_fleet: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ÿ≥ÿ∑ŸàŸÑ",
                    tbl_id: "ŸÖ",
                    tbl_name: "ÿßŸÑÿßÿ≥ŸÖ",
                    tbl_vehicle: "ÿßŸÑŸÖÿ±ŸÉÿ®ÿ©",
                    tbl_status: "ÿßŸÑÿ≠ÿßŸÑÿ©",
                    tbl_action: "ÿ•ÿ¨ÿ±ÿßÿ°",
                    dash_owner: "ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ© ŸÑŸÑŸÖÿßŸÑŸÉ",
                    kpi_revenue: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™",
                    kpi_trips: "ÿßŸÑÿ±ÿ≠ŸÑÿßÿ™",
                    kpi_users: "ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ",
                    kpi_commission: "ÿßŸÑÿπŸÖŸàŸÑÿ©",
                    chart_growth: "ÿßŸÑŸÜŸÖŸà ÿßŸÑÿ¥Ÿáÿ±Ÿä",
                    chart_types: "ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ±ÿ≠ŸÑÿßÿ™",
                    link_about: "ÿπŸÜ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ",
                    link_privacy: "ÿßŸÑÿÆÿµŸàÿµŸäÿ©",
                    link_support: "ÿßŸÑÿØÿπŸÖ",
                    status_free: "ŸÖÿ™ÿßÿ≠",
                    status_busy: "ŸÖÿ¥ÿ∫ŸàŸÑ",
                    ph_pickup: "ŸÖŸÉÿßŸÜ ÿßŸÑÿßŸÜÿ∑ŸÑÿßŸÇ",
                    ph_dest: "ÿßŸÑŸàÿ¨Ÿáÿ©"
                },
                en: {
                    welcome_title: "Choose Your Role",
                    welcome_sub: "Simulation Prototype - No Password Required",
                    role_passenger: "Passenger",
                    role_driver: "Driver",
                    role_admin: "Admin",
                    role_owner: "Owner",
                    desc_passenger: "Book rides & delivery",
                    desc_driver: "Accept jobs & earn",
                    desc_admin: "Manage operations",
                    desc_owner: "Business insights",
                    logout: "Logout",
                    hello: "Hello",
                    book_ride: "Book a Ride",
                    opt_personal: "Personal Ride",
                    opt_delivery: "Goods Delivery",
                    avail_drivers: "Available Drivers (Free)",
                    active_trip: "Active Trip",
                    no_active_trip: "No active trip.",
                    step_driver_proof: "Driver Proof",
                    step_you_confirm: "Your Confirm",
                    btn_confirm_receipt: "Confirm Receipt",
                    current_job: "Current Job",
                    waiting_jobs: "Waiting for requests...",
                    btn_upload_proof: "Upload Proof",
                    btn_end_trip: "End Trip",
                    my_earnings: "My Earnings",
                    dash_admin: "Admin Dashboard",
                    live_fleet: "Live Fleet Status",
                    tbl_id: "ID",
                    tbl_name: "Name",
                    tbl_vehicle: "Vehicle",
                    tbl_status: "Status",
                    tbl_action: "Action",
                    dash_owner: "Owner Overview",
                    kpi_revenue: "Total Revenue",
                    kpi_trips: "Total Trips",
                    kpi_users: "Active Users",
                    kpi_commission: "Net Commission",
                    chart_growth: "Monthly Growth",
                    chart_types: "Trip Types",
                    link_about: "About",
                    link_privacy: "Privacy",
                    link_support: "Support",
                    status_free: "Free",
                    status_busy: "Busy",
                    ph_pickup: "Pickup Location",
                    ph_dest: "Destination"
                }
            },

            // --- Initialization ---
            init() {
                this.updateUI();
            },

            // --- Authentication & Navigation ---
            login(role) {
                this.data.currentUserRole = role;
                
                // Hide landing
                document.getElementById('view-landing').classList.add('hidden');
                document.getElementById('btn-logout').classList.remove('hidden');

                // Show Specific Dashboard
                if(role === 'passenger') {
                    this.renderPassengerDash();
                    document.getElementById('view-passenger').classList.remove('hidden');
                } else if(role === 'driver') {
                    this.renderDriverDash();
                    document.getElementById('view-driver').classList.remove('hidden');
                } else if(role === 'admin') {
                    this.renderAdminDash();
                    document.getElementById('view-admin').classList.remove('hidden');
                } else if(role === 'owner') {
                    document.getElementById('view-owner').classList.remove('hidden');
                }
            },

            logout() {
                this.data.currentUserRole = null;
                // Hide all dashboards
                ['view-passenger', 'view-driver', 'view-admin', 'view-owner'].forEach(id => {
                    document.getElementById(id).classList.add('hidden');
                });
                // Show landing
                document.getElementById('view-landing').classList.remove('hidden');
                document.getElementById('btn-logout').classList.add('hidden');
            },

            // --- Passenger Logic ---
            renderPassengerDash() {
                const list = document.getElementById('driver-list');
                list.innerHTML = '';

                // Filter for Free drivers
                const freeDrivers = this.data.drivers.filter(d => d.status === 'free');
                
                if(freeDrivers.length === 0) {
                    list.innerHTML = '<div style="padding:1rem; text-align:center; opacity:0.7">No drivers available.</div>';
                } else {
                    freeDrivers.forEach(d => {
                        const div = document.createElement('div');
                        div.className = 'driver-row';
                        div.innerHTML = `
                            <div>
                                <strong>${d.name}</strong>
                                <div style="font-size:0.8rem; color:var(--text-muted)">${d.vehicle} ‚Ä¢ ‚òÖ${d.rating}</div>
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="app.bookDriver(${d.id})">
                                ${this.data.lang === 'ar' ? 'ÿ≠ÿ¨ÿ≤' : 'Book'}
                            </button>
                        `;
                        list.appendChild(div);
                    });
                }

                // Update Active Ride Panel
                const activePanel = document.getElementById('passenger-active-panel');
                if(this.data.activeRide) {
                    activePanel.style.opacity = '1';
                    activePanel.style.pointerEvents = 'all';
                    document.getElementById('passenger-status-msg').innerHTML = `
                        <div style="color:var(--primary); font-weight:bold; margin-bottom:0.5rem;">Driver En Route</div>
                        <div>Your ride with ID #${this.data.activeRide.driverId} is active.</div>
                    `;
                    
                    // Show delivery protocol if applicable
                    const protocol = document.getElementById('delivery-protocol-ui');
                    if(this.data.activeRide.type === 'delivery') {
                        protocol.classList.remove('hidden');
                        const proofStep = document.getElementById('chk-driver-proof');
                        const confirmBtn = document.getElementById('btn-user-confirm');

                        if(this.data.activeRide.status === 'proof_done') {
                            proofStep.classList.add('done');
                            confirmBtn.disabled = false;
                        } else {
                            proofStep.classList.remove('done');
                            confirmBtn.disabled = true;
                        }
                    } else {
                        protocol.classList.add('hidden');
                    }
                } else {
                    activePanel.style.opacity = '0.5';
                    activePanel.style.pointerEvents = 'none';
                    document.getElementById('passenger-status-msg').innerText = this.i18n[this.data.lang].no_active_trip;
                    document.getElementById('delivery-protocol-ui').classList.add('hidden');
                }
            },

            bookDriver(driverId) {
                const srvType = document.getElementById('service-type').value;
                
                // Set Driver to Busy
                const driverIdx = this.data.drivers.findIndex(d => d.id === driverId);
                this.data.drivers[driverIdx].status = 'busy';

                // Set Active Ride
                this.data.activeRide = {
                    driverId: driverId,
                    type: srvType,
                    status: 'active'
                };

                alert(this.data.lang === 'ar' ? "ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ŸÑŸÑÿ≥ÿßÿ¶ŸÇ!" : "Request sent to driver!");
                this.renderPassengerDash();
            },

            passengerConfirmReceipt() {
                if(confirm("Confirm receipt?")) {
                    this.completeSystemRide();
                }
            },

            // --- Driver Logic ---
            renderDriverDash() {
                // In a real app, we'd check if the logged-in driver has the active ride.
                // For prototype, we assume Driver #1 (Sayed) is the logged-in user if Active Ride exists with ID 1.
                
                // Assuming logged in as ID 1 for demo
                const driverId = 1;
                const myStatus = this.data.drivers.find(d => d.id === driverId).status;
                
                const badge = document.getElementById('driver-status-badge');
                badge.innerText = myStatus === 'free' ? this.i18n[this.data.lang].status_free : this.i18n[this.data.lang].status_busy;
                badge.className = myStatus === 'free' ? 'badge badge-free' : 'badge badge-busy';
                
                document.getElementById('driver-earnings').innerText = this.data.driverEarnings;

                const jobArea = document.getElementById('driver-job-area');
                const controls = document.getElementById('driver-active-controls');
                const btnProof = document.getElementById('btn-driver-proof');

                // If there is an active ride assigned to this driver logic (simulated by global activeRide)
                if(this.data.activeRide && this.data.activeRide.driverId === driverId) {
                    jobArea.classList.add('hidden');
                    controls.classList.remove('hidden');
                    document.getElementById('job-type').innerText = this.data.activeRide.type;

                    if(this.data.activeRide.type === 'delivery') {
                        btnProof.classList.remove('hidden');
                        if(this.data.activeRide.status === 'proof_done') {
                            btnProof.innerText = "‚úî Proof Sent";
                            btnProof.disabled = true;
                        } else {
                            btnProof.innerText = "üì∑ Upload Proof";
                            btnProof.disabled = false;
                        }
                    } else {
                        btnProof.classList.add('hidden');
                    }

                } else {
                    jobArea.classList.remove('hidden');
                    controls.classList.add('hidden');
                }
            },

            driverUploadProof() {
                // Simulate upload
                this.data.activeRide.status = 'proof_done';
                this.renderDriverDash();
                alert("Proof uploaded. Waiting for user confirmation.");
            },

            driverCompleteRide() {
                this.completeSystemRide();
            },

            completeSystemRide() {
                // Reset Logic
                const dId = this.data.activeRide.driverId;
                const dIdx = this.data.drivers.findIndex(d => d.id === dId);
                this.data.drivers[dIdx].status = 'free'; // Set back to free
                
                this.data.driverEarnings += 50; // Add dummy money
                this.data.activeRide = null; // Clear ride

                alert(this.data.lang === 'ar' ? "ÿ™ŸÖ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ±ÿ≠ŸÑÿ©" : "Ride Completed");
                
                // Re-render current view
                if(this.data.currentUserRole === 'driver') this.renderDriverDash();
                if(this.data.currentUserRole === 'passenger') this.renderPassengerDash();
            },


            // --- Admin Logic ---
            renderAdminDash() {
                const tbody = document.getElementById('admin-fleet-list');
                tbody.innerHTML = '';
                this.data.drivers.forEach(d => {
                    const tr = document.createElement('tr');
                    tr.style.borderBottom = '1px solid var(--border)';
                    const statusClass = d.status === 'free' ? 'badge-free' : 'badge-busy';
                    const statusText = d.status === 'free' ? this.i18n[this.data.lang].status_free : this.i18n[this.data.lang].status_busy;
                    
                    tr.innerHTML = `
                        <td style="padding:1rem;">#${d.id}</td>
                        <td>${d.name}</td>
                        <td>${d.vehicle}</td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td><button class="btn btn-outline" style="padding:0.25rem 0.5rem; font-size:0.7rem">Edit</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            // --- Utils ---
            toggleTheme() {
                this.data.theme = this.data.theme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', this.data.theme);
            },

            toggleLang() {
                this.data.lang = this.data.lang === 'ar' ? 'en' : 'ar';
                document.documentElement.setAttribute('lang', this.data.lang);
                document.documentElement.setAttribute('dir', this.data.lang === 'ar' ? 'rtl' : 'ltr');
                document.getElementById('lang-disp').innerText = this.data.lang === 'ar' ? 'EN' : 'ÿπÿ±ÿ®Ÿä';
                this.updateUI();
            },

            updateUI() {
                const t = this.i18n[this.data.lang];
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    el.innerText = t[el.getAttribute('data-i18n')];
                });
                document.querySelectorAll('[data-i18n-ph]').forEach(el => {
                    el.placeholder = t[el.getAttribute('data-i18n-ph')];
                });
                // Refresh current view if needed
                if(this.data.currentUserRole === 'passenger') this.renderPassengerDash();
                if(this.data.currentUserRole === 'driver') this.renderDriverDash();
                if(this.data.currentUserRole === 'admin') this.renderAdminDash();
            },

            toggleServiceType() {
                // Just re-render or handle UI toggles if needed
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => app.init());
        
        // Add Spin Animation
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
